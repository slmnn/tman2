<h3>
    Territories ({{itemCount}})

    <div class="col-xs-6 pull-right list-search">
        <a
            data-ng-if="user.admin"
            data-ui-sref="examples.territory.add"
            data-tooltip="Add new territory"
        ><i class="fa fa-plus-circle"></i></a>

        <list-search
            data-filters="filters"
            data-options="itemsPerPageOptions"
            data-items="itemsPerPage"
        ></list-search>

        <pagination class="pagination-sm"
            data-total-items="itemCount"
            data-ng-model="currentPage"
            data-items-per-page="itemsPerPage"
            data-max-size="10"
            data-boundary-links="true"
            data-rotate="false"
        ></pagination>
    </div>
</h3>

<div class="row">
    <div class="col-sm-12">
        <table class="table">
            <thead class="noSelect">
            <tr>
                <th class="text-nowrap {{item.class}}"
                    data-ng-repeat="item in titleItems | filter:titleFilter"
                >
                    <a
                        data-ng-show="item.column"
                        data-ng-click="changeSort(item)"
                        data-ng-bind-html="item.title"
                    ></a>
                    <span
                        data-ng-show="!item.column"
                        data-ng-bind-html="item.title"
                    ></span>

                    <i class="fa"
                        data-ng-show="sort.column == item.column"
                        data-ng-class="{'fa-angle-down': !sort.direction, 'fa-angle-up': sort.direction}"
                    ></i>
                </th>
            </tr>
            </thead>
            <tbody data-ng-repeat="territory in items">
                <tr data-ng-class="territory.checked ? 'bg-info' : ''">
                    <td class="col-md-1">
                        <a data-ui-sref="examples.territory({id: territory.id})">
                            <strong>{{territory.territoryCode || territory.id}}</strong>
                        </a>
                    </td>
                    <td class="col-md-1">
                        {{territory.type}}
                    </td>
                    <td class="col-md-1">
                        {{territory.covered | date : 'dd.MM.yyyy'}}
                    </td>
                    <td class="col-md-1">
                        {{territory.taken | date : 'dd.MM.yyyy'}}
                    </td>
                    <td class="col-md-1">
                        <ul class="list-inline">
                            <li data-ng-repeat="tla in territory.territoryLinkAttribute">
                                <span 
                                    class="fa fa-{{getAttributeWithId(attributes, tla.attribute).icon}}"
                                    data-tooltip="{{getAttributeWithId(attributes, tla.attribute).name}} - {{getAttributeWithId(attributes, tla.attribute).description}}"
                                >
                                </span>
                            </li>
                        </ul>
                    </td>
                    <td class="col-md-3">
                        {{territory.description | limitTo : 40}}
                        {{territory.description.length > 40 ? '...' : ''}}
                    </td>
                    <td class="col-md-1">
                        {{territory.territoryHolderHistory[territory.territoryHolderHistory.length - 1].description | limitTo : 20}}
                        {{territory.territoryHolderHistory[territory.territoryHolderHistory.length - 1].description.length > 20 ? '...' : ''}}
                    </td>
                    <td class="col-md-2">
                        <a data-ui-sref="examples.holder({id: territory.holder.id})">
                            {{territory.holder.name}}
                        </a>
                    </td>
                    <td class="col-md-1">
                        <label class="whitespace-label">
                            <input type="checkbox" 
                                class="big-checkbox"
                                id="checkbox_{{territory.id}}"
                                data-ng-model="territory.checked" 
                                data-ng-change="territoryChecked(territory)">
                            </input>
                        </label>
                    </td>
                </tr>

                <tr data-ng-if="items.length === 0">
                    <td colspan="100%" class="text-center text-muted">
                        <em>no data found...</em>
                    </td>
                </tr>
            </tbody>
        </table>
  </div>
</div>

<div class="row">
    <div class="col-sm-12">
        <pagination class="pagination-sm pull-right"
            data-total-items="itemCount"
            data-ng-model="currentPage"
            data-items-per-page="itemsPerPage"
            data-max-size="10"
            data-boundary-links="true"
            data-rotate="false"
        ></pagination>
  </div>
</div>


<div class="row top-buffer">
    <div class="col-sm-12">
        <div class="panel panel-primary" data-ng-show="filteredItems.length > 0">
          <div class="panel-heading">
            Operations for {{filteredItems.length}} selected territories
            <button 
                class="btn btn-xs btn-primary pull-right" 
                data-ng-click="clearSelected(items)"
            >
                Clear selection
            </button>
          </div>
          <div class="panel-body">    
            <ul class="list-inline">
                <li class="vertical-list" data-ng-repeat="t in filteredItems = (items | filter : onlyCheckedTerritories)">
                    
                    <a data-ui-sref="examples.territory({id: t.id})">
                        <h3>{{t.territoryCode || t.id}}</h3>
                    </a>
                    
                </li>
            </ul>
            <hr>
            <form>
                <div class="row">
                    <div class="col-md-6 col-md-offset-1">
                        <label>
                            Additional info:
                        </label>
                        <textarea 
                            class="form-control"
                            type="text" 
                            maxlength="300"
                            rows="3"
                            data-ng-model="territoryChangeComment"
                            placeholder="Additional comment"
                        ></textarea>
                    </div>
                    <div class="col-md-4 bg-info">
                        <p>
                            To complete the operation you may want to add an additional 
                            comment regarding the change. For example, it might be useful 
                            to comment about territories covered in memorial invitation campaign etc.
                            Please, write your comment in the input below. Commenting is optional.

                        </p>
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="col-md-6 col-md-offset-1">
                        <button 
                            class="btn btn-primary btn-sm" 
                            data-ng-click="markTerritoriesAsCovered(filteredItems, territoryChangeComment)"
                        >
                            Mark as covered without changing holder
                        </button>
                    </div>
                    <div class="col-md-4 bg-info">
                        <p>
                            You might want to just mark the territories as covered without changing their holders. 
                            Do so, by clicking the "Mark as covered without changing holder" button.
                        </p>
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="col-md-6 col-md-offset-1">
                        <label>Select new holder:</label>
                        <select 
                            class="form-control"
                            data-ng-model="selectedHolder"
                            data-ng-options="holder.id as holder.name for holder in holders"
                        >
                        </select>
                        <button 
                            class="btn btn-primary btn-sm top-buffer" 
                            data-ng-disable="!selectedHolder"
                            data-ng-click="changeHolder(filteredItems, true, selectedHolder, territoryChangeComment)"
                        >
                            Change holder and mark as coverd
                        </button>
                        <button 
                            class="btn btn-primary btn-sm top-buffer" 
                            data-ng-disable="!selectedHolder"
                            data-ng-click="changeHolder(filteredItems, false, selectedHolder, territoryChangeComment)"
                        >
                            Change holder without marking as covered
                        </button>
                    </div>
                    <div class="col-md-4 bg-info">
                        <p>
                            To change territory holder, continue as follows:
                            <ol>
                                <li>Select the new holder from the dropdown.</li> 
                                <li>Change the holder and mark the territories as covered by 
                                    clicking "Change holder and mark as coverd" button. If you do not want
                                    to mark the territories as covered, you should click the 
                                    "Change holder without marking as covered" button.</li>
                            </ol>
                        </p>
                    </div>
                </div>
            </form>
          </div>
        </div>
  </div>
</div>
